<svg viewBox="-160 -10 1819.5 1605" style="max-width:1819.5px;" height="100%" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaidChart322"><style title="mermaid-svg-internal-css" type="text/css">/*  */
*, *::before, *::after { box-sizing: inherit;}
.actor { stroke: rgb(204, 204, 255); fill: rgb(226, 236, 255);}
text.actor { fill: black; stroke: none; font-size: 12px;}
.actor-line { stroke: grey;}
.messageLine0 { stroke-width: 1.5; stroke: black;}
.messageLine1 { stroke-width: 1.5; stroke: black;}
#arrowhead { fill: black;}
.messageText { fill: black; stroke: none; font-size: 12px;}
.labelBox { stroke: rgb(204, 204, 255); fill: rgb(236, 236, 255);}
.labelText { fill: black; stroke: none;}
.loopText { fill: black; stroke: none;}
.loopLine { stroke-width: 2; stroke: rgb(204, 204, 255);}
.note { stroke: rgb(204, 204, 255); fill: rgb(255, 245, 173);}
.noteText { fill: black; stroke: none; font-size: 12px;}
.actor { stroke: rgb(204, 204, 255); fill: rgb(236, 236, 255);}
text.actor { fill: black; stroke: none;}
.actor-line { stroke: grey;}
.messageLine0 { stroke-width: 1.5; stroke: rgb(51, 51, 51);}
.messageLine1 { stroke-width: 1.5; stroke: rgb(51, 51, 51);}
#arrowhead { fill: rgb(51, 51, 51);}
#crosshead path { fill: rgb(51, 51, 51) ! important; stroke: rgb(51, 51, 51) ! important;}
.messageText { fill: rgb(51, 51, 51); stroke: none;}
.labelBox { stroke: rgb(204, 204, 255); fill: rgb(236, 236, 255);}
.labelText { fill: black; stroke: none;}
.loopText { fill: black; stroke: none;}
.loopLine { stroke-width: 2; stroke: rgb(204, 204, 255);}
.note { stroke: rgb(170, 170, 51); fill: rgb(255, 245, 173);}
.noteText { fill: black; stroke: none; font-family: "trebuchet ms",verdana,arial; font-size: 14px;}
text { font-family: "trebuchet ms",verdana,arial; font-size: 14px;}
/*  */
</style><g></g><g><line stroke="#999" stroke-width="0.5px" class="actor-line" y2="1594" x2="75" y1="5" x1="75" id="actor2611"></line><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle;" class="actor" y="37.5" x="75">Root CA</text></g><g><line stroke="#999" stroke-width="0.5px" class="actor-line" y2="1594" x2="275" y1="5" x1="275" id="actor2612"></line><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="200"></rect><text style="text-anchor: middle;" class="actor" y="37.5" x="275">HSM</text></g><g><line stroke="#999" stroke-width="0.5px" class="actor-line" y2="1594" x2="475" y1="5" x1="475" id="actor2613"></line><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="400"></rect><text style="text-anchor: middle;" class="actor" y="37.5" x="475">Autograph</text></g><g><line stroke="#999" stroke-width="0.5px" class="actor-line" y2="1594" x2="675" y1="5" x1="675" id="actor2614"></line><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="600"></rect><text style="text-anchor: middle;" class="actor" y="37.5" x="675">Service Admin</text></g><g><line stroke="#999" stroke-width="0.5px" class="actor-line" y2="1594" x2="875" y1="5" x1="875" id="actor2615"></line><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="800"></rect><text style="text-anchor: middle;" class="actor" y="37.5" x="875">Service DB</text></g><g><line stroke="#999" stroke-width="0.5px" class="actor-line" y2="1594" x2="1075" y1="5" x1="1075" id="actor2616"></line><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="1000"></rect><text style="text-anchor: middle;" class="actor" y="37.5" x="1075">Service Endpoint</text></g><g><line stroke="#999" stroke-width="0.5px" class="actor-line" y2="1594" x2="1275" y1="5" x1="1275" id="actor2617"></line><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="1200"></rect><text style="text-anchor: middle;" class="actor" y="37.5" x="1275">CDN</text></g><g><line stroke="#999" stroke-width="0.5px" class="actor-line" y2="1594" x2="1475" y1="5" x1="1475" id="actor2618"></line><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="1400"></rect><text style="text-anchor: middle;" class="actor" y="37.5" x="1475">Firefox</text></g><defs><marker orient="auto" markerHeight="4" markerWidth="6" refY="2" refX="5" id="arrowhead"><path d="M 0,0 V 4 L6,2 Z"></path></marker></defs><defs><marker refY="4" refX="16" orient="auto" markerHeight="8" markerWidth="15" id="crosshead"><path d="M 9,2 V 6 L16,4 Z" stroke-width="1px" style="stroke-dasharray: 0, 0;" stroke="#000000" fill="black"></path><path d="M 0,1 L 6,7 M 6,1 L 0,7" stroke-width="1px" style="stroke-dasharray: 0, 0;" stroke="#000000" fill="none"></path></marker></defs><g><text class="messageText" style="text-anchor: middle;" y="118" x="75">make key pair, store privkey offline</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" d="M 75,125 C 135,115 135,155 75,145"></path></g><g><rect class="note" ry="0" rx="0" height="36" width="150" stroke="#666" fill="#EDF2AE" y="165" x="-100"></rect><text class="noteText" fill="black" y="193" x="-84"><tspan x="-84">Ca, ttl=10years</tspan></text></g><g><text class="messageText" style="text-anchor: middle;" y="229" x="275">make key pair, store privkey in hsm</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" d="M 275,236 C 335,226 335,266 275,256"></path></g><g><text class="messageText" style="text-anchor: middle;" y="294" x="175">get signed intermediate cert Ci</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" y2="301" x2="75" y1="301" x1="275"></line></g><g><text class="messageText" style="text-anchor: middle;" y="329" x="175">Ci</text><line marker-end="url(#arrowhead)" stroke="black" stroke-width="2" class="messageLine1" style="stroke-dasharray: 3, 3; fill: none;" y2="336" x2="275" y1="336" x1="75"></line></g><g><rect class="note" ry="0" rx="0" height="36" width="150" stroke="#666" fill="#EDF2AE" y="346" x="100"></rect><text class="noteText" fill="black" y="374" x="116"><tspan x="116">Ci, ttl=2years</tspan></text></g><g><text class="messageText" style="text-anchor: middle;" y="410" x="475">make key pair on server</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" d="M 475,417 C 535,407 535,447 475,437"></path></g><g><text class="messageText" style="text-anchor: middle;" y="475" x="375">get signed end-entity cert Cee</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" y2="482" x2="275" y1="482" x1="475"></line></g><g><text class="messageText" style="text-anchor: middle;" y="510" x="375">Cee</text><line marker-end="url(#arrowhead)" stroke="black" stroke-width="2" class="messageLine1" style="stroke-dasharray: 3, 3; fill: none;" y2="517" x2="475" y1="517" x1="275"></line></g><g><rect class="note" ry="0" rx="0" height="36" width="150" stroke="#666" fill="#EDF2AE" y="527" x="300"></rect><text class="noteText" fill="black" y="555" x="316"><tspan x="316">Cee, ttl=45days</tspan></text></g><g><text class="messageText" style="text-anchor: middle;" y="591" x="875">publish chain of trust Cee+Ci+Ca at location x5u</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" y2="598" x2="1275" y1="598" x1="475"></line></g><g><rect class="note" ry="0" rx="0" height="36" width="150" stroke="#666" fill="#EDF2AE" y="608" x="1100"></rect><text class="noteText" fill="black" y="636" x="1116"><tspan x="1116">Cee+Ci+Ca</tspan></text></g><g><line class="loopLine" stroke="#526e52" stroke-width="2" y2="75" x2="1285" y1="75" x1="-110"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="654" x2="1285" y1="75" x1="1285"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="654" x2="1285" y1="654" x1="-110"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="654" x2="-110" y1="75" x1="-110"></line><rect class="labelBox" ry="0" rx="0" height="20" width="50" stroke="none" fill="#526e52" y="75" x="-110"></rect><text class="labelText" fill="white" y="90" x="-102.5"><tspan x="-102.5">opt</tspan></text><text class="loopText" fill="black" style="text-anchor: middle;" y="90" x="587.5"><tspan x="587.5">[ Chain of Trust Issuance ]</tspan></text></g><g><text class="messageText" style="text-anchor: middle;" y="707" x="575">POST /sign/data</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" y2="714" x2="475" y1="714" x1="675"></line></g><g><text class="messageText" style="text-anchor: middle;" y="742" x="575">Content-Signature</text><line marker-end="url(#arrowhead)" stroke="black" stroke-width="2" class="messageLine1" style="stroke-dasharray: 3, 3; fill: none;" y2="749" x2="675" y1="749" x1="475"></line></g><g><text class="messageText" style="text-anchor: middle;" y="777" x="775">insert Data+Content-Signature</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" y2="784" x2="875" y1="784" x1="675"></line></g><g><rect class="note" ry="0" rx="0" height="57" width="150" stroke="#666" fill="#EDF2AE" y="794" x="700"></rect><text class="noteText" fill="black" y="822" x="716"><tspan x="716">Data +</tspan><tspan x="716" dy="21">Content-Signature</tspan></text></g><g><text class="messageText" style="text-anchor: middle;" y="879" x="1275">get /data</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" y2="886" x2="1075" y1="886" x1="1475"></line></g><g><text class="messageText" style="text-anchor: middle;" y="914" x="975">select data</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" y2="921" x2="875" y1="921" x1="1075"></line></g><g><text class="messageText" style="text-anchor: middle;" y="949" x="1275">Data + Content-Signature</text><line marker-end="url(#arrowhead)" stroke="black" stroke-width="2" class="messageLine1" style="stroke-dasharray: 3, 3; fill: none;" y2="956" x2="1475" y1="956" x1="1075"></line></g><g><rect class="note" ry="0" rx="0" height="57" width="150" stroke="#666" fill="#EDF2AE" y="966" x="1300"></rect><text class="noteText" fill="black" y="994" x="1316"><tspan x="1316">Data +</tspan><tspan x="1316" dy="21">Content-Signature</tspan></text></g><g><line class="loopLine" stroke="#526e52" stroke-width="2" y2="664" x2="1485" y1="664" x1="465"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="1033" x2="1485" y1="664" x1="1485"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="1033" x2="1485" y1="1033" x1="465"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="1033" x2="465" y1="664" x1="465"></line><rect class="labelBox" ry="0" rx="0" height="20" width="50" stroke="none" fill="#526e52" y="664" x="465"></rect><text class="labelText" fill="white" y="679" x="472.5"><tspan x="472.5">opt</tspan></text><text class="loopText" fill="black" style="text-anchor: middle;" y="679" x="975"><tspan x="975">[ Signature Issuance ]</tspan></text></g><g><text class="messageText" style="text-anchor: middle;" y="1086" x="1475">check local cache for x5u</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" d="M 1475,1093 C 1535,1083 1535,1123 1475,1113"></path></g><g><text class="messageText" style="text-anchor: middle;" y="1151" x="1375">get x5u/chain.pem</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" y2="1158" x2="1275" y1="1158" x1="1475"></line></g><g><text class="messageText" style="text-anchor: middle;" y="1186" x="1375">Cee+Ci+Ca</text><line marker-end="url(#arrowhead)" stroke="black" stroke-width="2" class="messageLine1" style="stroke-dasharray: 3, 3; fill: none;" y2="1193" x2="1475" y1="1193" x1="1275"></line></g><g><rect class="note" ry="0" rx="0" height="36" width="150" stroke="#666" fill="#EDF2AE" y="1203" x="1300"></rect><text class="noteText" fill="black" y="1231" x="1316"><tspan x="1316">Cee+Ci+Ca</tspan></text></g><g><text class="messageText" style="text-anchor: middle;" y="1267" x="1475">Verify Content-Signature using Cee</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" d="M 1475,1274 C 1535,1264 1535,1304 1475,1294"></path></g><g><text class="messageText" style="text-anchor: middle;" y="1332" x="1475">Verify chain of trust Cee+Ci+Ca</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" d="M 1475,1339 C 1535,1329 1535,1369 1475,1359"></path></g><g><text class="messageText" style="text-anchor: middle;" y="1397" x="1475">Verify public key hash of Ca with configuration</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" d="M 1475,1404 C 1535,1394 1535,1434 1475,1424"></path></g><g><text class="messageText" style="text-anchor: middle;" y="1462" x="1475">pass Data to next step</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="black" stroke-width="2" class="messageLine0" d="M 1475,1469 C 1535,1459 1535,1499 1475,1489"></path></g><g><line class="loopLine" stroke="#526e52" stroke-width="2" y2="1043" x2="1609.5" y1="1043" x1="1265"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="1509" x2="1609.5" y1="1043" x1="1609.5"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="1509" x2="1609.5" y1="1509" x1="1265"></line><line class="loopLine" stroke="#526e52" stroke-width="2" y2="1509" x2="1265" y1="1043" x1="1265"></line><rect class="labelBox" ry="0" rx="0" height="20" width="50" stroke="none" fill="#526e52" y="1043" x="1265"></rect><text class="labelText" fill="white" y="1058" x="1272.5"><tspan x="1272.5">opt</tspan></text><text class="loopText" fill="black" style="text-anchor: middle;" y="1058" x="1437.25"><tspan x="1437.25">[ Signature verification ]</tspan></text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="1529" x="0"></rect><text style="text-anchor: middle;" class="actor" y="1566.5" x="75">Root CA</text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="1529" x="200"></rect><text style="text-anchor: middle;" class="actor" y="1566.5" x="275">HSM</text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="1529" x="400"></rect><text style="text-anchor: middle;" class="actor" y="1566.5" x="475">Autograph</text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="1529" x="600"></rect><text style="text-anchor: middle;" class="actor" y="1566.5" x="675">Service Admin</text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="1529" x="800"></rect><text style="text-anchor: middle;" class="actor" y="1566.5" x="875">Service DB</text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="1529" x="1000"></rect><text style="text-anchor: middle;" class="actor" y="1566.5" x="1075">Service Endpoint</text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="1529" x="1200"></rect><text style="text-anchor: middle;" class="actor" y="1566.5" x="1275">CDN</text></g><g><rect class="actor" ry="3" rx="3" height="65" width="150" stroke="#666" fill="#eaeaea" y="1529" x="1400"></rect><text style="text-anchor: middle;" class="actor" y="1566.5" x="1475">Firefox</text></g></svg>